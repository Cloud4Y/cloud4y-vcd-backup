# VMware Cloud Director Backup Automation

Автоматизированные скрипты для резервного копирования VMware Cloud Director с ротацией архивов
и записью результатов в файл для мониторинга.

## Скрипты

### 1. `backup-vcd.sh`
- Предназначен для использования **в одиночном инстансе VMware Cloud Director**.
- Выполняет:
  - запуск штатного бэкапа (`create-backup.sh`),
  - ротацию старых архивов,
  - запись флагового файла для мониторинга (`/var/log/create-backup-vcd-flag`).

### 2. `backup-vcd-cluster.sh`
- Предназначен для **кластерной установки**.
- Скрипт размещается на **каждой ноде кластера**, выполняется **на primary-ноде**,
чтобы избежать дублирования резервных копий.
- Остальной функционал аналогичен `backup-vcd.sh`.

## Использование

1. Разместите скрипт на сервере VMware Cloud Director, где будут выполняться бэкапы.
2. Сделайте файл исполняемым:

```bash
chmod +x backup-vcd.sh
```
3. Запуск:

```bash
./backup-vcd.sh
```

## Интеграция с Zabbix

Скрипты создают файл-флаг `/var/log/create-backup-vcd-flag`:

* `1` — резервная копия создана успешно
* `0` — ошибка при выполнении

Для мониторинга необходимо:

* Установить Zabbix-агент на appliance.
* Создать текстовый элемент данных, указывающий на файл флага:
```
vfs.file.contents[/var/log/create-backup-vcd-flag]
```
* Настроить триггер, который срабатывает при значении `0`.

## This document in English

- [README.md](README.md)
